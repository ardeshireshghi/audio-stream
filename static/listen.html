<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Web dictaphone</title>
    <link href="/static/styles/app.css" rel="stylesheet" type="text/css">
  </head>
  <body>

    <div class="wrapper">

      <header>
        <h1>Listen to stream</h1>
      </header>
      <audio id="player"></audio>
      <button id="play">Play stream</button>


    <script>

      document.getElementById('play').onclick = () => {
        const audio = document.getElementById('player')

        audio.src = `/stream?t=${Date.now()}`
        audio.controls = true;
        audio.play()

        audio.onpause = () => {
          if (isFinite(audio.duration) && Math.abs(audio.duration - audio.currentTime) < 0.1 ) {
            const lastCurrentTime = audio.currentTime
            audio.src = `/stream?t=${Date.now()}`

            audio.addEventListener('loadeddata', () =>
            {

              audio.play()
              audio.currentTime = lastCurrentTime
            }, {once: true})
          }
        }
      }
    </script>

  </body>
</html>